---
author: DBlogAdmin
comments: false
date: 2019-01-05 08:36:15+00:00
layout: post
link: https://dlang.org/blog/2019/01/05/dmd-2-084-0-has-arrived/
slug: dmd-2-084-0-has-arrived
title: DMD 2.084.0 Has Arrived
wordpress_id: 1891
categories:
- '#dbugfix'
- DMD Releases
---

![](http://dlang.org/blog/wp-content/uploads/2016/08/d6.png)The D Language Foundation is pleased to present version 2.084.0 of DMD, the reference D compiler. It’s [available for download at dlang.org](https://dlang.org/download.html), where you can also [find the full changelog](https://dlang.org/changelog/2.084.0.html). There are a few changes and new features to be found, as usual, along with [100 closed Bugzilla issues](https://dlang.org/changelog/2.084.0.html#bugfix-list) this time around.


### Finer Control Over Run-time Checks


[The new compiler flag `-check`](https://dlang.org/dmd-windows.html#switch-check) is a feature that [grew out of DIP 1006](https://github.com/dlang/DIPs/blob/master/DIPs/DIP1006.md) and some internal discussions around its content. The flag allows overriding the default behavior of six specific categories of run-time checks by specifically turning them `on` or `off`:



 	
  * `assert` - assertion checks

 	
  * `bounds` - bounds checks

 	
  * `in` - `in` contracts

 	
  * `invariant` - class and struct invariants

 	
  * `out` - `out` contracts

 	
  * `switch` - default switch cases


For example, when compiling without `-release`, all run-time checks are enabled by default. To disable only assertion checks:

```bash
dmd -check=assert=off foo.d
```
This can be further refined with [the new `-checkaction` flag](https://dlang.org/dmd-windows.html#switch-checkaction), which determines how the program will respond when an assertion, bounds, or switch check fails. There are four options: `D`, `C`, and `halt`.



 	
  * `D` - the default D behavior, which is to throw an `Error` to indicate an unrecoverable condition.

 	
  * `C` - behave as a C program by calling the assertion failure function in the C runtime.

 	
  * `halt` - execute a halt instruction to terminate the program.


Listed in the language documentation is a fourth option: `context`. This causes failed checks to throw an `Error` to indicate an unrecoverable condition, and also print the error context. It isn't present in this release, but is coming in DMD 2.085 (the online documentation is generated from [the DMD master branch](https://github.com/dlang/dmd)).


### Save Your Mixins


One of D’s most popular and powerful features is [the `mixin` statement](https://dlang.org/spec/statement.html#mixin-statement), commonly referred to as _string mixins_ to avoid confusion [with _template mixins_](https://dlang.org/spec/template-mixin.html). Unfortunately, given that string mixins can be composed from multiple compile-time function calls, they are also notoriously painful to debug as they grow in complexity. The new `-mixin` compiler option aims to do away with that pain.

Consider the following simple (contrived) example, which attempts to generate a function call with a string mixin:

```d
import std.stdio;

void hello() { writeln("Hello!"); }

void main() {
    mixin(hello.stringof ~ "();");
}
```
Save as `hello.d`, compile with `dmd hello`, and you’ll see an error along these lines:

    <code>hello.d-mixin-6(6): Error: function expected before (), not hello() of type void</code>
The error does say exactly what the problem is, but even in this simple case it may require re-reading the message a few times before working out what it’s actually saying. So let’s recompile with the `-mixin` flag. It requires a file name. I’ve selected `mixed.txt`:

    <code>dmd -mixin=mixed.txt hello.d</code>
Now we see this output:

    mixed.txt(110): Error: function expected before (), not hello() of type void
See the difference? The error now refers to a line number in a file with the name we provided, rather than a line in the autogenerated `hello.d-mixin-6` to which we couldn’t refer. Open `mixed.txt` and navigate to line 110 to find the generated code, along with a comment at line 109:

    // expansion at foo.d(6)
    hello()();
And now the error is quite clear. Invoking `.stringof` on a function provides you with the function name including the parentheses, so there’s no need to append parentheses to the result. We can now change the example so that it will compile:

```d
void main() {
    mixin(hello.stringof ~ ";");
}
```
Anyone making significant use of string mixins to generate code will undoubtedly find this feature useful. It will be particularly helpful for the maintainers of D-friendly IDEs and plugins to make the user experience more convenient.


### New DUB features


DMD 2.084.0 ships with version 1.13.0 of DUB, [the D build tool and package manager](https://code.dlang.org/). It gets some new goodies with this release.

[The new `add` command](https://dlang.org/changelog/2.084.0.html#addcommand) is a convenience to add dependencies to a project’s package recipe. No need to worry about the syntax and whether the recipe is written using JSON or SDLang. Simply run dub with the `add` command, specifying one or more dub packages, and the recipe will be modified accordingly. For example, to add [the BindBC bindings](https://github.com/BindBC) for the GLFW and OpenGL C libraries:

```bash
dub add bindbc-glfw bindbc-opengl
```
This will add the latest version of each library. This can be restricted to a specific version by appending `=` to the package name along with the normal [DUB syntax for version specifications](https://github.com/dlang/dub/wiki/Version-management#basic-dependency-specification). This can also be used to change the version specification of an existing dependency.

For those unfamiliar with DUB, executing `dub run`, or simply `dub`, in a directory containing a dub recipe will build a project according to the recipe and, if the project is an executable, run it once the build completes. Now, there are [two new recipe directives](https://dlang.org/changelog/2.084.0.html#pre-post-run-commands) that can be used to achieve more specialized goals. `preRunCommands` specifies commands to execute before the DUB target is run, and `postRunCommands` specifies commands to execute when the run is complete. See the DUB package recipe documentation for [the JSON syntax](https://dub.pm/package-format-json.html) or [the SDLang syntax](https://dub.pm/package-format-sdl.html), under “Build Settings” in each, to see what they look like.


### That’s Not All


Regarding the 100 closed Bugzilla issues, two points should be made.

First is that among many of the Pull Request merges that closed those issues, you’ll find Nicholas Wilson’s GitHub handle. Nicholas is, of course, the community member the D Language Foundation asked to serve as PR Manager, to be paid [through a fundraising campaign](https://www.flipcause.com/secure/cause_pdetails/NDUwNTY=). He’s been reviving old PRs and making sure new ones don’t go stale. This release is evidence that the initiative is paying off. And the icing on the cake is that the D community enabled us to meet our fundraising target well before our February 14th deadline. Thanks!

Second, a point relevant to [the #dbugfix campaign](https://dlang.org/blog/2018/02/03/the-dbugfix-campaign/). While I was disappointed that participation in nominating Bugzilla issues on Twitter and in the Forums dwindled to near zero, the previous nominations were not forgotten. The original goal was to fix at least two nominated issues per cycle, so several nominated bugs were never selected. However, thanks to Eduard Staniloiu and Razvan Nitu, two among that group are now closed and fixed in this release:



 	
  * #13300 - [pure function ‘std.array.Appender!(T[]).Appender.ensureAddable’ cannot call impure function ‘test.T.__fieldPostBlit’](https://issues.dlang.org/show_bug.cgi?id=13300),

 	
  * #18572 - [AliasSeq default arguments are broken](https://issues.dlang.org/show_bug.cgi?id=18572)


I’m still happy to take #dbugfix nominations. If you’ve got a Bugzilla issue that’s bugging you, tweet a link to it with #dbugfix in the text, or start a thread in the General forum with #dbugfix in the title. I’ll make a note of it and, rather than counting votes and selecting two of the top five, see if I can find someone to do something about it.
