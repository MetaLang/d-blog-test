---
author: DBlogAdmin
comments: false
date: 2019-07-05 13:48:22+00:00
layout: post
link: https://dlang.org/blog/2019/07/05/dmd-2-087-0-released/
slug: dmd-2-087-0-released
title: DMD 2.087.0 Released
wordpress_id: 2109
categories:
- Compilers &amp; Tools
- DMD Releases
- Donations
---

![Digital Mars logo](http://dlang.org/blog/wp-content/uploads/2016/08/d6.png)The latest release of the Digital Mars D compiler (DMD) is now available. Version 2.087.0 marks 44 closed Bugzilla issues and 22 major changes [courtesy of 63 contributors](https://dlang.org/changelog/2.087.0.html#contributors). See [the changelog for the details](https://dlang.org/changelog/2.087.0.html) and related links. Visit [the Digital Mars Downloads page](https://dlang.org/download.html) to get the release package for your platform(s).

One of the changes in this release is the end of a transitional period regarding imports, another involves a certain compiler switch and the compilation of Phobos. There's also something developers on Windows will find useful, and more options for documenting code with Ddoc.


## Endings and beginnings


Once upon a time, [two](https://issues.dlang.org/show_bug.cgi?id=313) related compiler [issues](https://issues.dlang.org/show_bug.cgi?id=314) were reported in [the D bug tracker](https://issues.dlang.org/), where they remained for years beyond measure (it was actually just shy of a decade). These bugs allowed symbols to sometimes be accessed inside a scope in which they weren’t supposed to be visible. Eventually, once the bugs were fixed, two switches were introduced to help users maintain their existing code: `-transtion=import` caused the code to compile under the old, incorrect behavior, and `-transition=checkimport` would report on all occurences of the erroneous behavior in a code base. Steven Schveighoffer [did a write up about it all on his blog](http://www.schveiguy.com/blog/2016/03/import-changes-in-d-2-071/) at the time, which is a good read for anyone interested in the details.

In DMD 2.087.0, [the transitional period is over](https://dlang.org/changelog/2.087.0.html#remove_visibility). The `-transition=import` and `-transition=checkimports` switches no longer have any effect. Henceforth, if you have any existing code you've been compiling with `-transition=import`, your code will break with the new release if you are still relying on the old buggy behavior.

As one period ends, another begins. A new deprecation will give you warnings if you are initializing immutable global data [via a static constructor](https://dlang.org/spec/class.html#static-constructor) like so:

    
    immutable int bar;
    static this()
    {
        bar = 42;
    }


This behavior is deprecated. Static constructors and destructors are called once per thread. Given that immutable global data is implicitly shared across threads rather than being thread-local like normal D variables, data like `bar` would be overwritten every time a new thread is spawned. The fix is to ensure that the static constructor is also shared across threads:

    
    immutable int bar;
    shared static this()
    {
        bar = 42;
    }


Static constructors and destructors marked `shared` are invoked once per process rather than once per thread.


## DIP 1000 and Phobos


[DIP 1000 was the first D Improvement Proposal](https://github.com/dlang/DIPs/blob/master/DIPs/other/DIP1000.md) submitted after the DIP process was transformed from an informal, wiki-based approach, to a formal, managed approach with structured review periods. It proposed a feature called “Scoped Pointers” intended to “provide a mechanism to guarantee that a reference cannot escape lexical scope”. Unfortunately, the document itself remained in a sort of limbo as the proposed feature was implemented and evolved. Eventually, the implementation diverged from the proposal to such a degree that the DIP was marked as `Superseded` and retired. But not the feature!

The `-preview=dip1000` flag has been available for some time now, but it has been a bit tricky to use given that the standard library could not be compiled with it. With DMD 2.087.0, that is true no more. [Phobos now compiles with `-preview=dip1000`](https://dlang.org/changelog/2.087.0.html#phobos-dip1000) and D programmers can now more easily make use of the feature.

Given that this is still in preview mode and hasn’t yet seen enough wide-spread use, please don’t be surprised if you uncover any bugs. Please do report any bugs you find [to the issue tracker](https://issues.dlang.org/) so that they can be squashed as soon as possible.


## Explicitly choose the LLD linker on Windows


From the beginning, DMD shipped with self-contained support for 32-bit development on Windows. This was possible because Walter Bright made use of the existing platform libraries [and linker (OPTLINK)](https://www.digitalmars.com/ctg/optlink.html) that he was already shipping with his [Digital Mars C and C++ compiler](https://www.digitalmars.com/download/freecompiler.html). Unfortunately, OPTLINK only supports [the OMF object format](https://en.wikipedia.org/wiki/Relocatable_Object_Module_Format), so the output of DMD on Windows was incompatible with the greater Windows ecosystem which is primarily built around the PE COFF output (see [this PDF of the specification](https://en.wikipedia.org/wiki/COFF)) of the Microsoft build tools. PE COFF, known as MSCOFF in the D universe, is a Microsoft-specific version of [the COFF format](https://courses.cs.washington.edu/courses/cse378/03wi/lectures/LinkerFiles/coff.pdf).

Eventually, Walter added MSCOFF support to DMD for 64-bit (and later, 32-bit) development, but that required that developers have the Microsoft linker and platform libraries installed. In the past, that meant installing either Visual Studio or the Microsoft Build Tools package along with the Windows SDK. In recent years, installing Visual Studio Community edition would provide everything necessary. When compiling with `-m64` or `-m32mscoff`, OPTLINK would be ignored in favor of the Microsoft linker.

With [the release of DMD 2.079.0](https://dlang.org/changelog/2.079.0.html#lld_mingw), the compiler began shipping with the LLVM linker (LLD), a set of platform libraries derived from those that ship with [the MinGW compiler](https://mingw-w64.org/doku.php), and a wrapper library for the Visual C++ 2010 runtime. From that point forward, when given `-m64` or `-m32mscoff` on Windows, the compiler would search for the Microsoft installation and, if not found, fallback on the bundled linker and libraries if they were installed. For the first time, DMD had self-contained 64-bit output on Windows. (Interestingly, it's never been self-contained on other platforms, where DMD relies on the system linker and libraries, the presence of which is a given and not a source of complaint as the dependence on the MS linker has been.)

Now that the new set up has been put through its paces for a while and some of the kinks have been ironed out, DMD 2.087.0 makes it possible to explicitly select the bundled MSCOFF import libraries and LLD linker via the command line switch `-mscrtlib=msvcrt100`.


## Markdown support in Ddoc


[Ddoc was originally designed](https://dlang.org/spec/ddoc.html) as a macro-based system for documenting source code, but its use has expanded beyond that scenario in the years since. Most sections of [the dlang.org website](https://dlang.org/) are created with Ddoc, as is [the dconf.org site](http://dconf.org/2019/index.html). Ali Çehreli used it to write his book, [Programming in D](http://ddili.org/ders/d.en/index.html).

Support for Markdown-like syntax has been requested now and again in the forums. Now that’s available in DMD 2.087. It’s currently in preview mode, so it requires the `-preview=markdown` flag. There are some differences from the other flavors of Markdown you may be familiar with, so be sure to read [the list of supported features before putting it to use](https://dlang.org/spec/ddoc.html#highlighting).


## Supporting the development of D


Much of the blood, sweat, and tears that went into this and every release of the compiler was provided by volunteers. They do the work they can within the constraints of their knowledge, skills, experience and, the mother of all limiters, time. There are some tasks that have yet to fit within the bounds of any volunteer’s constraints. These will require dedicated effort to strike off the list.

To that end, I’d like to remind everyone that we are raising money for [a Human Resource Fund](https://dlang.org/blog/2019/04/15/manpower-in-the-d-ecosystem-or-resources-resources-resources/) that we will use to bring in some folks specifically to tackle these difficult tasks. [WekaIO seeded the fund](https://www.weka.io/) with a generous contribution and a few of our community members have thrown some of their own resources into the pot with the gratitude of the D Language Foundation.

But we need more! We still have DConf 2019 t-shirts for anyone who wants to throw $60 at the HR fund, as well as DMan shirts and DConf 2020 registration discounts for those able and willing to donate more. [See my recent blog post](https://dlang.org/blog/2019/06/23/dconf-t-shirts-and-the-human-resource-fund/) on the topic for details to make sure you donate to the correct campaign in order to get the shirt you want.

Another reminder: if you want to become a Gold Donor or Personal Sponsor [on our Open Collective page](https://opencollective.com/dlang) (which is separate from the HR Fund – again, [read my recent blog post](https://dlang.org/blog/2019/06/23/dconf-t-shirts-and-the-human-resource-fund/) to avoid confusion), please either ensure your email address is included in your profile or contact me directly to let me know who you are. Otherwise, I can’t send you a DMan shirt!
